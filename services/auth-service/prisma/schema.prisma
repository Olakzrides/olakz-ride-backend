generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/auth-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email            String            @unique @db.VarChar(255)
  firstName        String            @map("first_name") @db.VarChar(100)
  lastName         String            @map("last_name") @db.VarChar(100)
  username         String?           @unique @db.VarChar(50)
  passwordHash     String?           @map("password_hash") @db.VarChar(255)
  role             String?           @default("customer") @db.VarChar(50)
  provider         String?           @default("emailpass") @db.VarChar(50)
  phone            String?           @db.VarChar(20)
  avatarUrl        String?           @map("avatar_url")
  emailVerified    Boolean?          @default(false) @map("email_verified")
  status           String?           @default("active") @db.VarChar(20)
  lastLoginAt      DateTime?         @map("last_login_at") @db.Timestamptz(6)
  createdAt        DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime?         @default(now()) @map("updated_at") @db.Timestamptz(6)
  roles            String[]          @default(["customer"])
  activeRole       String?           @default("customer") @map("active_role") @db.VarChar(20)
  otpVerifications OtpVerification[]
  refreshTokens    RefreshToken[]

  @@index([activeRole], map: "idx_users_active_role")
  @@index([email], map: "idx_users_email")
  @@index([username], map: "idx_users_username")
  @@map("users")
}

model RefreshToken {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  token     String    @unique @db.VarChar(255)
  expiresAt DateTime  @map("expires_at") @db.Timestamptz(6)
  revoked   Boolean?  @default(false)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([token], map: "idx_refresh_tokens_token")
  @@index([userId], map: "idx_refresh_tokens_user_id")
  @@map("refresh_tokens")
}

model OtpVerification {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  type      String    @db.VarChar(50)
  code      String    @db.VarChar(10)
  expiresAt DateTime  @map("expires_at") @db.Timestamptz(6)
  verified  Boolean?  @default(false)
  attempts  Int?      @default(0)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([type], map: "idx_otp_verifications_type")
  @@index([userId], map: "idx_otp_verifications_user_id")
  @@map("otp_verifications")
}

model LoginAttempt {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email       String    @db.VarChar(255)
  ipAddress   String?   @map("ip_address") @db.Inet
  success     Boolean
  attemptedAt DateTime? @default(now()) @map("attempted_at") @db.Timestamptz(6)

  @@index([email], map: "idx_login_attempts_email")
  @@map("login_attempts")
}

model OtpResendTracking {
  id       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email    String    @db.VarChar(255)
  resentAt DateTime? @default(now()) @map("resent_at") @db.Timestamptz(6)

  @@map("otp_resend_tracking")
}

model advertisements {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title       String    @db.VarChar(255)
  description String?
  image_url   String?
  link_url    String?
  rank        Int?      @default(0)
  active      Boolean?  @default(true)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  name        String?   @default("")
  updatedAt   DateTime? @default(now())

  @@index([active, rank], map: "idx_advertisements_active_rank")
}

model cart_line_items {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cart_id       String        @db.Uuid
  variant_id    String        @db.Uuid
  quantity      Int           @default(1)
  unit_price    Decimal       @db.Decimal(10, 2)
  total_price   Decimal       @db.Decimal(10, 2)
  created_at    DateTime      @default(now()) @db.Timestamptz(6)
  ride_carts    ride_carts    @relation(fields: [cart_id], references: [id], onDelete: Cascade)
  ride_variants ride_variants @relation(fields: [variant_id], references: [id])

  @@unique([cart_id, variant_id])
  @@index([cart_id])
  @@index([variant_id])
}

model driver_availability {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  driver_id    String   @unique @db.Uuid
  is_online    Boolean  @default(false)
  is_available Boolean  @default(false)
  last_seen_at DateTime @default(now()) @db.Timestamptz(6)
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  updated_at   DateTime @default(now()) @db.Timestamptz(6)
  drivers      drivers  @relation(fields: [driver_id], references: [id], onDelete: Cascade)

  @@index([is_available])
  @@index([is_online])
  @@index([last_seen_at])
}

model driver_documents {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  driver_id              String?                  @db.Uuid
  document_type          String                   @db.VarChar(100)
  document_url           String
  file_name              String                   @db.VarChar(255)
  file_size              Int
  mime_type              String                   @db.VarChar(100)
  status                 String                   @default("pending") @db.VarChar(50)
  verified_by            String?                  @db.Uuid
  verified_at            DateTime?                @db.Timestamptz(6)
  expiry_date            DateTime?                @db.Timestamptz(6)
  notes                  String?
  created_at             DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at             DateTime                 @default(now()) @db.Timestamptz(6)
  session_id             String?                  @db.Uuid
  version_number         Int?                     @default(1)
  parent_document_id     String?                  @db.Uuid
  is_current_version     Boolean?                 @default(true)
  replaced_at            DateTime?                @db.Timestamptz(6)
  replacement_reason     String?
  file_path              String?
  ocr_data               Json?                    @default("{}")
  extracted_text         String?
  expiry_date_extracted  DateTime?                @db.Date
  validation_errors      Json?                    @default("[]")
  document_notifications document_notifications[]
  document_reviews       document_reviews[]
  drivers                drivers?                 @relation(fields: [driver_id], references: [id], onDelete: Cascade)
  driver_documents       driver_documents?        @relation("driver_documentsTodriver_documents", fields: [parent_document_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_driver_documents driver_documents[]       @relation("driver_documentsTodriver_documents")

  @@index([document_type])
  @@index([driver_id])
  @@index([status])
  @@index([session_id])
  @@index([parent_document_id], map: "idx_driver_documents_parent")
  @@index([session_id], map: "idx_driver_documents_session")
  @@index([driver_id, document_type, version_number], map: "idx_driver_documents_version")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model driver_location_tracking {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  driver_id     String    @db.Uuid
  latitude      Decimal   @db.Decimal(10, 8)
  longitude     Decimal   @db.Decimal(11, 8)
  heading       Decimal?  @db.Decimal(5, 2)
  speed         Decimal?  @db.Decimal(5, 2)
  accuracy      Decimal?  @db.Decimal(6, 2)
  is_online     Boolean?  @default(true)
  is_available  Boolean?  @default(true)
  battery_level Int?
  app_version   String?   @db.VarChar(20)
  device_info   Json?     @default("{}")
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  drivers       drivers   @relation(fields: [driver_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_driver_location_tracking_created_at")
  @@index([driver_id, created_at], map: "idx_driver_location_tracking_driver_created")
  @@index([driver_id], map: "idx_driver_location_tracking_driver_id")
  @@index([is_online, is_available], map: "idx_driver_location_tracking_online_available")
}

model driver_locations {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  driver_id  String   @db.Uuid
  latitude   Decimal  @db.Decimal(10, 8)
  longitude  Decimal  @db.Decimal(11, 8)
  heading    Decimal? @db.Decimal(5, 2)
  speed      Decimal? @db.Decimal(5, 2)
  accuracy   Decimal? @db.Decimal(6, 2)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  drivers    drivers  @relation(fields: [driver_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([driver_id])
}

model driver_vehicles {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  driver_id       String        @db.Uuid
  vehicle_type_id String        @db.Uuid
  plate_number    String        @unique @db.VarChar(50)
  manufacturer    String        @db.VarChar(100)
  model           String        @db.VarChar(100)
  year            Int
  color           String        @db.VarChar(50)
  is_active       Boolean       @default(true)
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  updated_at      DateTime      @default(now()) @db.Timestamptz(6)
  drivers         drivers       @relation(fields: [driver_id], references: [id], onDelete: Cascade)
  vehicle_types   vehicle_types @relation(fields: [vehicle_type_id], references: [id])

  @@index([driver_id])
  @@index([is_active])
  @@index([vehicle_type_id])
}

model drivers {
  id                       String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                  String                     @unique @db.Uuid
  license_number           String?                    @db.VarChar(100)
  vehicle_type_id          String                     @db.Uuid
  status                   String                     @default("pending") @db.VarChar(50)
  rating                   Decimal                    @default(0) @db.Decimal(3, 2)
  total_rides              Int                        @default(0)
  total_earnings           Decimal                    @default(0) @db.Decimal(10, 2)
  approved_by              String?                    @db.Uuid
  approved_at              DateTime?                  @db.Timestamptz(6)
  rejection_reason         String?
  created_at               DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at               DateTime                   @default(now()) @db.Timestamptz(6)
  identification_type      String?                    @db.VarChar(50)
  identification_number    String?                    @unique(map: "idx_drivers_identification_number") @db.VarChar(100)
  driver_availability      driver_availability?
  driver_documents         driver_documents[]
  driver_location_tracking driver_location_tracking[]
  driver_locations         driver_locations[]
  driver_vehicles          driver_vehicles[]
  vehicle_types            vehicle_types              @relation(fields: [vehicle_type_id], references: [id])
  ride_requests            ride_requests[]
  rides                    rides[]

  @@index([created_at])
  @@index([rating])
  @@index([status])
  @@index([user_id])
  @@index([vehicle_type_id])
}

model regions {
  id            String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String       @db.VarChar(100)
  currency_code String       @db.VarChar(3)
  country_code  String       @db.VarChar(2)
  is_active     Boolean      @default(true)
  metadata      Json         @default("{}")
  created_at    DateTime     @default(now()) @db.Timestamptz(6)
  ride_carts    ride_carts[]

  @@index([country_code])
  @@index([is_active])
}

model ride_carts {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String            @db.Uuid
  region_id         String            @db.Uuid
  sales_channel_id  String            @db.Uuid
  currency_code     String            @db.VarChar(3)
  pickup_latitude   Decimal           @db.Decimal(10, 8)
  pickup_longitude  Decimal           @db.Decimal(11, 8)
  pickup_address    String
  dropoff_latitude  Decimal?          @db.Decimal(10, 8)
  dropoff_longitude Decimal?          @db.Decimal(11, 8)
  dropoff_address   String?
  passengers        Int               @default(1)
  search_radius     Int               @default(10)
  status            String            @default("active") @db.VarChar(20)
  metadata          Json              @default("{}")
  created_at        DateTime          @default(now()) @db.Timestamptz(6)
  updated_at        DateTime          @default(now()) @db.Timestamptz(6)
  cart_line_items   cart_line_items[]
  regions           regions           @relation(fields: [region_id], references: [id])
  rides             rides[]

  @@index([created_at])
  @@index([status])
  @@index([user_id])
}

model ride_products {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title         String          @db.VarChar(100)
  handle        String          @unique @db.VarChar(100)
  description   String?
  thumbnail_url String?
  is_active     Boolean         @default(true)
  metadata      Json            @default("{}")
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  ride_variants ride_variants[]

  @@index([handle])
  @@index([is_active])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ride_requests {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  ride_id              String    @db.Uuid
  driver_id            String    @db.Uuid
  status               String?   @default("pending") @db.VarChar(20)
  sent_at              DateTime? @default(now()) @db.Timestamptz(6)
  responded_at         DateTime? @db.Timestamptz(6)
  expires_at           DateTime  @db.Timestamptz(6)
  batch_number         Int?      @default(1)
  distance_from_pickup Decimal   @db.Decimal(8, 2)
  estimated_arrival    Int
  created_at           DateTime? @default(now()) @db.Timestamptz(6)
  updated_at           DateTime? @default(now()) @db.Timestamptz(6)
  drivers              drivers   @relation(fields: [driver_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  rides                rides     @relation(fields: [ride_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([ride_id, driver_id])
  @@index([batch_number], map: "idx_ride_requests_batch_number")
  @@index([driver_id], map: "idx_ride_requests_driver_id")
  @@index([driver_id, status], map: "idx_ride_requests_driver_status")
  @@index([expires_at], map: "idx_ride_requests_expires_at")
  @@index([ride_id], map: "idx_ride_requests_ride_id")
  @@index([ride_id, status], map: "idx_ride_requests_ride_status")
  @@index([status], map: "idx_ride_requests_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ride_status_updates {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  ride_id         String    @db.Uuid
  status          String    @db.VarChar(30)
  previous_status String?   @db.VarChar(30)
  updated_by      String    @db.Uuid
  updated_by_type String    @db.VarChar(20)
  message         String?
  location        Json?     @default("{}")
  metadata        Json?     @default("{}")
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  rides           rides     @relation(fields: [ride_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_ride_status_updates_created_at")
  @@index([ride_id, created_at], map: "idx_ride_status_updates_ride_created")
  @@index([ride_id], map: "idx_ride_status_updates_ride_id")
  @@index([status], map: "idx_ride_status_updates_status")
}

model ride_variants {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  product_id       String            @db.Uuid
  vehicle_type_id  String            @db.Uuid
  title            String            @db.VarChar(50)
  sku              String            @unique @db.VarChar(50)
  base_price       Decimal           @db.Decimal(10, 2)
  price_per_km     Decimal           @db.Decimal(10, 2)
  price_per_minute Decimal           @default(0) @db.Decimal(10, 2)
  minimum_fare     Decimal           @db.Decimal(10, 2)
  is_active        Boolean           @default(true)
  metadata         Json              @default("{}")
  created_at       DateTime          @default(now()) @db.Timestamptz(6)
  cart_line_items  cart_line_items[]
  ride_products    ride_products     @relation(fields: [product_id], references: [id], onDelete: Cascade)
  vehicle_types    vehicle_types     @relation(fields: [vehicle_type_id], references: [id])
  rides            rides[]

  @@index([is_active])
  @@index([product_id])
  @@index([sku])
  @@index([vehicle_type_id])
}

model rides {
  id                                                             String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cart_id                                                        String?               @db.Uuid
  user_id                                                        String                @db.Uuid
  driver_id                                                      String?               @db.Uuid
  variant_id                                                     String                @db.Uuid
  status                                                         String                @default("searching") @db.VarChar(30)
  pickup_latitude                                                Decimal               @db.Decimal(10, 8)
  pickup_longitude                                               Decimal               @db.Decimal(11, 8)
  pickup_address                                                 String
  dropoff_latitude                                               Decimal?              @db.Decimal(10, 8)
  dropoff_longitude                                              Decimal?              @db.Decimal(11, 8)
  dropoff_address                                                String?
  estimated_distance                                             Decimal?              @db.Decimal(8, 2)
  estimated_duration                                             Int?
  actual_distance                                                Decimal?              @db.Decimal(8, 2)
  actual_duration                                                Int?
  estimated_fare                                                 Decimal               @db.Decimal(10, 2)
  final_fare                                                     Decimal?              @db.Decimal(10, 2)
  payment_method                                                 String                @default("wallet") @db.VarChar(20)
  payment_status                                                 String                @default("pending") @db.VarChar(20)
  scheduled_at                                                   DateTime?             @db.Timestamptz(6)
  started_at                                                     DateTime?             @db.Timestamptz(6)
  completed_at                                                   DateTime?             @db.Timestamptz(6)
  cancelled_at                                                   DateTime?             @db.Timestamptz(6)
  cancellation_reason                                            String?
  driver_rating                                                  Int?
  driver_feedback                                                String?
  passenger_rating                                               Int?
  passenger_feedback                                             String?
  metadata                                                       Json                  @default("{}")
  created_at                                                     DateTime              @default(now()) @db.Timestamptz(6)
  updated_at                                                     DateTime              @default(now()) @db.Timestamptz(6)
  payment_hold_id                                                String?               @db.Uuid
  currency_code                                                  String?               @default("NGN") @db.VarChar(3)
  ride_requests                                                  ride_requests[]
  ride_status_updates                                            ride_status_updates[]
  wallet_transactions_rides_payment_hold_idTowallet_transactions wallet_transactions?  @relation("rides_payment_hold_idTowallet_transactions", fields: [payment_hold_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_rides_payment_hold")
  ride_carts                                                     ride_carts?           @relation(fields: [cart_id], references: [id])
  drivers                                                        drivers?              @relation(fields: [driver_id], references: [id])
  ride_variants                                                  ride_variants         @relation(fields: [variant_id], references: [id])
  wallet_transactions                                            wallet_transactions[]

  @@index([created_at])
  @@index([driver_id])
  @@index([status, created_at])
  @@index([status])
  @@index([user_id])
  @@index([payment_hold_id], map: "idx_rides_payment_hold")
  @@index([user_id, status], map: "idx_rides_user_status")
}

model service_channels {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String                @unique @db.VarChar(255)
  description         String?
  icon_url            String?
  active              Boolean?              @default(true)
  rank                Int?                  @default(0)
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?             @default(now()) @db.Timestamptz(6)
  products            products[]
  service_regions     service_regions[]
  user_service_usages user_service_usages[]

  @@index([active, rank], map: "idx_service_channels_active_rank")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model socket_connections {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  socket_id       String    @unique @db.VarChar(100)
  user_id         String    @db.Uuid
  user_type       String    @db.VarChar(20)
  is_connected    Boolean?  @default(true)
  last_activity   DateTime? @default(now()) @db.Timestamptz(6)
  device_info     Json?     @default("{}")
  app_version     String?   @db.VarChar(20)
  connected_at    DateTime? @default(now()) @db.Timestamptz(6)
  disconnected_at DateTime? @db.Timestamptz(6)

  @@index([is_connected], map: "idx_socket_connections_is_connected")
  @@index([last_activity], map: "idx_socket_connections_last_activity")
  @@index([user_id, is_connected], map: "idx_socket_connections_user_connected")
  @@index([user_id], map: "idx_socket_connections_user_id")
  @@index([user_type], map: "idx_socket_connections_user_type")
}

model user_otps {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email      String    @db.VarChar(255)
  otp        String    @db.VarChar(10)
  type       String    @default("email_verification") @db.VarChar(50)
  expires_at DateTime  @db.Timestamptz(6)
  attempts   Int?      @default(0)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
}

model user_sessions {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String    @db.Uuid
  session_token String    @db.VarChar(255)
  expires_at    DateTime  @db.Timestamptz(6)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
}

model vehicle_types {
  id                           String                         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                         String                         @db.VarChar(50)
  description                  String?
  base_fare_per_km             Decimal                        @db.Decimal(10, 2)
  base_fare_per_minute         Decimal                        @default(0) @db.Decimal(10, 2)
  minimum_fare                 Decimal                        @db.Decimal(10, 2)
  capacity                     Int                            @default(4)
  icon_url                     String?
  is_active                    Boolean                        @default(true)
  metadata                     Json                           @default("{}")
  created_at                   DateTime                       @default(now()) @db.Timestamptz(6)
  license_required             Boolean                        @default(true)
  insurance_required           Boolean                        @default(true)
  registration_required        Boolean                        @default(true)
  display_name                 String?                        @db.VarChar(100)
  driver_vehicles              driver_vehicles[]
  drivers                      drivers[]
  ride_variants                ride_variants[]
  vehicle_service_capabilities vehicle_service_capabilities[]

  @@index([is_active])
  @@index([name])
}

model wallet_transactions {
  id                                               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                                          String   @db.Uuid
  ride_id                                          String?  @db.Uuid
  transaction_type                                 String   @db.VarChar(20)
  amount                                           Decimal  @db.Decimal(10, 2)
  currency_code                                    String   @db.VarChar(3)
  status                                           String   @default("pending") @db.VarChar(20)
  reference                                        String?  @unique @db.VarChar(100)
  description                                      String?
  metadata                                         Json     @default("{}")
  created_at                                       DateTime @default(now()) @db.Timestamptz(6)
  updated_at                                       DateTime @default(now()) @db.Timestamptz(6)
  rides_rides_payment_hold_idTowallet_transactions rides[]  @relation("rides_payment_hold_idTowallet_transactions")
  rides                                            rides?   @relation(fields: [ride_id], references: [id])

  @@index([reference])
  @@index([ride_id])
  @@index([status])
  @@index([transaction_type])
  @@index([user_id])
  @@index([user_id, transaction_type, status])
  @@index([user_id, currency_code, status], map: "idx_wallet_transactions_user_currency")
}

model document_access_logs {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  document_id String   @db.Uuid
  user_id     String   @db.Uuid
  action      String   @db.VarChar(50)
  ip_address  String?  @db.Inet
  user_agent  String?
  metadata    Json?
  created_at  DateTime @default(now()) @db.Timestamptz(6)

  @@index([action])
  @@index([created_at])
  @@index([document_id])
  @@index([user_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model document_notifications {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  document_id       String           @db.Uuid
  user_id           String           @db.Uuid
  notification_type String           @db.VarChar(30)
  email_sent        Boolean?         @default(false)
  email_sent_at     DateTime?        @db.Timestamptz(6)
  email_error       String?
  retry_count       Int?             @default(0)
  metadata          Json?            @default("{}")
  created_at        DateTime?        @default(now()) @db.Timestamptz(6)
  driver_documents  driver_documents @relation(fields: [document_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_document_notifications_created")
  @@index([document_id], map: "idx_document_notifications_document")
  @@index([email_sent], map: "idx_document_notifications_email_sent")
  @@index([notification_type], map: "idx_document_notifications_type")
  @@index([user_id], map: "idx_document_notifications_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model document_reviews {
  id                    String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  document_id           String           @db.Uuid
  reviewer_id           String           @db.Uuid
  action                String           @db.VarChar(20)
  status                String           @default("pending") @db.VarChar(20)
  notes                 String?
  rejection_reason      String?
  replacement_requested Boolean?         @default(false)
  priority              String?          @default("normal") @db.VarChar(10)
  metadata              Json?            @default("{}")
  reviewed_at           DateTime?        @db.Timestamptz(6)
  created_at            DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?        @default(now()) @db.Timestamptz(6)
  driver_documents      driver_documents @relation(fields: [document_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([action], map: "idx_document_reviews_action")
  @@index([created_at], map: "idx_document_reviews_created")
  @@index([document_id], map: "idx_document_reviews_document")
  @@index([priority], map: "idx_document_reviews_priority")
  @@index([reviewer_id], map: "idx_document_reviews_reviewer")
  @@index([status], map: "idx_document_reviews_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model driver_registration_sessions {
  id                           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                      String    @db.Uuid
  vehicle_type                 String    @db.VarChar(50)
  service_types                String[]  @default([])
  status                       String    @default("initiated") @db.VarChar(20)
  progress_percentage          Int       @default(0)
  current_step                 String    @default("personal_info") @db.VarChar(30)
  expires_at                   DateTime  @db.Timestamptz(6)
  created_at                   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                   DateTime  @default(now()) @db.Timestamptz(6)
  personal_info_completed_at   DateTime? @db.Timestamptz(6)
  vehicle_details_completed_at DateTime? @db.Timestamptz(6)
  documents_completed_at       DateTime? @db.Timestamptz(6)
  submitted_at                 DateTime? @db.Timestamptz(6)
  personal_info_data           Json?
  vehicle_details_data         Json?
  documents_data               Json?
  metadata                     Json?     @default("{}")

  @@index([created_at])
  @@index([expires_at])
  @@index([status])
  @@index([user_id])
}

model products {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  serviceChannelId String           @db.Uuid
  handle           String           @unique
  title            String
  subtitle         String?
  description      String?
  thumbnail        String?
  isActive         Boolean          @default(true)
  metadata         Json             @default("{}")
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @default(now())
  service_channels service_channels @relation(fields: [serviceChannelId], references: [id], onDelete: Cascade)
}

model service_analytics {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  serviceChannelId String   @db.Uuid
  userId           String?  @db.Uuid
  eventType        String
  eventData        Json     @default("{}")
  timestamp        DateTime @default(now())
  sessionId        String?
  userAgent        String?
  ipAddress        String?
}

model service_regions {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  serviceChannelId String           @db.Uuid
  regionCode       String
  regionName       String?
  isAvailable      Boolean          @default(true)
  metadata         Json             @default("{}")
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @default(now())
  service_channels service_channels @relation(fields: [serviceChannelId], references: [id], onDelete: Cascade)

  @@unique([serviceChannelId, regionCode])
}

model service_types {
  id                           String                         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                         String                         @unique @db.VarChar(50)
  display_name                 String                         @db.VarChar(100)
  description                  String?
  is_active                    Boolean                        @default(true)
  created_at                   DateTime                       @default(now()) @db.Timestamptz(6)
  vehicle_service_capabilities vehicle_service_capabilities[]

  @@index([is_active])
}

model user_service_usages {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId           String           @db.Uuid
  serviceChannelId String           @db.Uuid
  sessionData      Json             @default("{}")
  startedAt        DateTime         @default(now())
  lastActivityAt   DateTime         @default(now())
  isActive         Boolean          @default(true)
  service_channels service_channels @relation(fields: [serviceChannelId], references: [id], onDelete: Cascade)
}

model vehicle_service_capabilities {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  vehicle_type_id String        @db.Uuid
  service_type_id String        @db.Uuid
  is_available    Boolean       @default(true)
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  service_types   service_types @relation(fields: [service_type_id], references: [id], onDelete: Cascade)
  vehicle_types   vehicle_types @relation(fields: [vehicle_type_id], references: [id], onDelete: Cascade)

  @@unique([vehicle_type_id, service_type_id], map: "vehicle_service_capabilities_vehicle_type_id_service_type_id_ke")
}
